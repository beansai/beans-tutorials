<img src="../../assets/images/beans-128x128.png" align="right" />

# Route Optimization With Units (Grouping)

Route Optimization With Units is a grouping mechanism to condense the stops.

For other route optimization conditions like pickup-dropoff pair, time window, assignee shift time, capacity... please see [Dynamic Route Optimization](https://github.com/beansai/beans-tutorials/tree/main/dynamic-routes-optimization)

## Table of contents
- [Route Optimization with units](#route-optimization-with-units)
    - [To Group stops that have same address](#to-group-stops-that-have-same-address)
    - [Group by Route](#group-by-route)
    - [Supported Mode](#supported-mode)

## To group stops that have same address
Let's say we have 5 stops for route "a3cc1ed1-8586-426e-b154-e46bc7bf0c66",

and 4 of them are with the same address.

Address: `9404` Central Ave, Montclair, CA 91763, United States
- a3cc1ed-1
- a3cc1ed-3
- a3cc1ed-4
- a3cc1ed-5

Address: `9000` Central Ave, Montclair, CA 91763, United States
- a3cc1ed-2

To see current stops for route `a3cc1ed1-8586-426e-b154-e46bc7bf0c66`

**Request**
```
GET {{baseURL}}/enterprise/v1/lists/routes/a3cc1ed1-8586-426e-b154-e46bc7bf0c66/items
```

**Response**
```json
{
    "item": [
        {
            "listItemId": "a3cc1ed-1",
            "address": "9404 Central Ave, Montclair, CA 91763, United States",
            "formattedAddress": "9404 Central Ave, Montclair, CA",
            "route": {
                "listRouteId": "a3cc1ed1-8586-426e-b154-e46bc7bf0c66"
            },
            
            // ...
        },
        {
            "listItemId": "a3cc1ed-2",
            "address": "9000 Central Ave, Montclair, CA 91763, United States",
            "formattedAddress": "9000 Central Ave, Montclair, CA",
            "route": {
                "listRouteId": "a3cc1ed1-8586-426e-b154-e46bc7bf0c66"
            },
            
            // ...
        },
        {
            "listItemId": "a3cc1ed-3",
            "address": "9404 Central Ave, Montclair, CA 91763, United States",
            "formattedAddress": "9404 Central Ave, Montclair, CA",
            "route": {
                "listRouteId": "a3cc1ed1-8586-426e-b154-e46bc7bf0c66"
            },
            
            // ...
        },
        {
            "listItemId": "a3cc1ed-4",
            "address": "9404 Central Ave, Montclair, CA 91763, United States",
            "formattedAddress": "9404 Central Ave, Montclair, CA",
            "route": {
                "listRouteId": "a3cc1ed1-8586-426e-b154-e46bc7bf0c66"
            },

            // ...
        },
        {
            "listItemId": "a3cc1ed-5",
            "address": "9404 Central Ave, Montclair, CA 91763, United States",
            "formattedAddress": "9404 Central Ave, Montclair, CA",
            "route": {
                "listRouteId": "a3cc1ed1-8586-426e-b154-e46bc7bf0c66"
            },
            
            // ...
        }
    ]
}
```
Let's group the stops that have same address by using mode `INPUT_ADDRESS`.

**Request**

```
POST {{baseURL}}/enterprise/v1/lists/items/do/optimizewithunits?mode=INPUT_ADDRESS
```

*Body*
```json
{
    "item": [
        {
            "listItemId": "a3cc1ed-1",
            "route": {
                "listRouteId": "a3cc1ed1-8586-426e-b154-e46bc7bf0c66"
            }
        },
        {
            "listItemId": "a3cc1ed-2",
            "route": {
                "listRouteId": "a3cc1ed1-8586-426e-b154-e46bc7bf0c66"
            }
        },
        {
            "listItemId": "a3cc1ed-3",
            "route": {
                "listRouteId": "a3cc1ed1-8586-426e-b154-e46bc7bf0c66"
            }
        },
        {
            "listItemId": "a3cc1ed-4",
            "route": {
                "listRouteId": "a3cc1ed1-8586-426e-b154-e46bc7bf0c66"
            }
        },
        {
            "listItemId": "a3cc1ed-5",
            "route": {
                "listRouteId": "a3cc1ed1-8586-426e-b154-e46bc7bf0c66"
            }
        }
    ]
}
```

**Response**

As we can see the stops with the same address have been groupped together

with a new listItemId `e20c85d1b155327a973e5fa41f0bd08d` under the field `children`.

You can see the full response at [optimize-with-units-response.json](assets/optimize-with-units-response.json) and there's the partial response.
```json
{
    "item": [
        {
            "listItemId": "a3cc1ed-2",
            "address": "9000 Central Ave, Montclair, CA 91763, United States",
            "formattedAddress": "9000 Central Ave, Montclair, CA",
            "status": "NEW",
            "route": {
                "listRouteId": "a3cc1ed1-8586-426e-b154-e46bc7bf0c66"
            },

            // ...
        },
        {
            "listItemId": "e20c85d1b155327a973e5fa41f0bd08d",
            "address": "9404 Central Ave, Montclair, CA",
            "notes": "Autogenerated by optimizer",
            "formattedAddress": "9404 Central Ave, Montclair, CA",
            "status": "NEW",
            "updatedAt": 1655347418000,
            "statusUpdatedAt": 1655347418000,
            "route": {
                "listRouteId": "a3cc1ed1-8586-426e-b154-e46bc7bf0c66"
            },
            "routePriority": -1,
            "trackingId": "NA, NA, NA, NA",
            "numPackages": 4,
            "type": "DROPOFF",
            "children": [
                {
                    "listItemId": "a3cc1ed-1",
                    "address": "9404 Central Ave, Montclair, CA 91763, United States",
                    "formattedAddress": "9404 Central Ave, Montclair, CA",
                    "status": "NEW",
                    // ...
                },
                {
                    "listItemId": "a3cc1ed-3",
                    "address": "9404 Central Ave, Montclair, CA 91763, United States",
                    "formattedAddress": "9404 Central Ave, Montclair, CA",
                    "status": "NEW",
                    // ...
                },
                {
                    "listItemId": "a3cc1ed-4",
                    "address": "9404 Central Ave, Montclair, CA 91763, United States",
                    "formattedAddress": "9404 Central Ave, Montclair, CA",
                    "status": "NEW",
                    // ...
                },
                {
                    "listItemId": "a3cc1ed-5",
                    "address": "9404 Central Ave, Montclair, CA 91763, United States",
                    "formattedAddress": "9404 Central Ave, Montclair, CA",
                    "status": "NEW",
                    // ...
                }
            ],
            "position": {
                "latitude": 34.082443,
                "longitude": -117.690918
            },
            // ...
        }
    ],
    "route": [
        {
            "listRouteId": "a3cc1ed1-8586-426e-b154-e46bc7bf0c66",
            "accountBuid": "4022a1aada0e4c4684e61e3f73290a68",
            "name": "Via Emilia a3c",
            "status": "OPEN",
            "createdAt": 1655346320000,
            "updatedAt": 1655347418000,
            "warehouse": {
                "listWarehouseId": "6f4f7bf9-b878-4eda-b01d-17dfcfcdadc3",
                "accountBuid": "4022a1aada0e4c4684e61e3f73290a68",
                "address": "3790 Wilshire Blvd, Los Angeles, CA 90010, United States",
                "formattedAddress": "3790 Wilshire Blvd, Los Angeles, CA",
                "createdAt": 1649284672000,
                "updatedAt": 1649284672000,
                "position": {
                    "latitude": 34.06169,
                    "longitude": -118.30861
                },
                "name": "Thermopylae"
            },
            "routePathMd5": "_zip_b4ad6ba8bdd7f4d07499fce9096ac7bd",
            "dateStr": "2031-02-21",
            "startMode": "WAREHOUSE",
            "endMode": "WAREHOUSE"
        }
    ]
}
```

## Group by Route
For some scenarios, one wishes to optimize an entire route regardless of how many stops there are, especially when the stops are being added dynamically. The following is a shorter version that would execute the same grouping process.

**Request example**

```
POST {{baseURL}}/lists/routes/{listRouteID}/do/optimizewithunits?mode=INPUT_ADDRESS
```

**Body**
None

***Note***
- POST request without the body
- 
## Supported Mode
- INPUT_ADDRESS - To group up stops that have the same address.
- INPUT_ADDRESS_UNIT_AND_CUSTOMER_NAME - to group stops that has the same (address, unit, customer name)
- INPUT_ADDRESS_AND_UNIT - to group stops that has the same (address, unit)
- BUILDING_ADDRESS - to group stops that has the same formatted_address
- FORMATTED_ADDRESS_AND_UNIT_NO_TIME_WINDOW - to group stops that has the same (formatted_address, unit)
